{% extends "base.html" %}

{% block title %}Connections - Postgres Explorer{% endblock %}

{% block nav_endpoints %}active{% endblock %}

{% block page_title %}Connections{% endblock %}

{% block page_subtitle %}
<div class="page-pretitle">Connection Management</div>
{% endblock %}

{% block page_actions %}
<div class="col-auto ms-auto d-print-none">
    <div class="btn-list">
        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modal-endpoint">
            <i class="ti ti-plus"></i>
            Add Connection
        </button>
    </div>
</div>
{% endblock %}

{% block content %}
<div class="row row-cards" hx-boost="false">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Saved Connections</h3>
            </div>
            <div class="card-body" id="endpoints-list">
                {% include "endpoints_list.html" %}
            </div>
        </div>
    </div>
</div>

<div class="modal modal-blur fade" id="modal-endpoint" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="endpoint-modal-title">Add Postgres Connection</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="endpoint-form" hx-post="/endpoints" hx-target="#endpoints-list" hx-swap="innerHTML" hx-push-url="false">
                <div class="modal-body">
                    <div id="endpoint-form-error" class="alert alert-danger d-none"></div>
                    <div class="mb-3">
                        <label class="form-label required">Name</label>
                        <input type="text" class="form-control" name="name" placeholder="Local Dev, Production, ..." required>
                        <small class="form-hint">Descriptive name for this connection</small>
                    </div>
                    <div class="mb-3">
                        <label class="form-label required">URL</label>
                        <input type="text" class="form-control" name="url" placeholder="postgres://host:5432/db" required>
                        <small class="form-hint">Complete URL including host, port and database</small>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">SSL/TLS Mode</label>
                        <select class="form-select" name="ssl_mode">
                            <option value="">Auto (prefer TLS, fallback to plaintext)</option>
                            <option value="disable">Disable - No TLS (plaintext only)</option>
                            <option value="prefer">Prefer - Try TLS first, fallback allowed</option>
                            <option value="require">Require - TLS required (no cert verification)</option>
                            <option value="verify-ca">Verify CA - TLS with CA verification</option>
                            <option value="verify-full">Verify Full - TLS with full cert verification</option>
                        </select>
                        <small class="form-hint">Controls SSL/TLS connection behavior</small>
                    </div>
                    <div class="mb-3">
                        <label class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" name="insecure">
                            <span class="form-check-label">Allow insecure TLS (self-signed certs)</span>
                        </label>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Default Schema (search_path)</label>
                        <input type="text" class="form-control" name="search_path" placeholder="public">
                        <small class="form-hint">Comma-separated list of schemas (e.g., myapp,public)</small>
                    </div>
                    <div class="mb-3">
                        <label class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" name="enable_blueprint">
                            <span class="form-check-label">Enable Blueprint Database Creator</span>
                        </label>
                        <small class="form-hint">Allows creating databases with role separation (requires SUPERUSER or CREATEROLE+CREATEDB privileges)</small>
                    </div>
                    <hr>
                    <h3 class="card-title">Basic Authentication</h3>
                    <div class="mb-3">
                        <label class="form-label">Username</label>
                        <input type="text" class="form-control" name="username" placeholder="postgres" autocomplete="username">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Password</label>
                        <input type="password" class="form-control" name="password" placeholder="Leave blank to keep current" autocomplete="current-password">
                        <small class="form-hint">
                            <i class="ti ti-lock"></i>
                            Password is stored encrypted in local database
                        </small>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary" id="endpoint-submit-btn">
                        <i class="ti ti-check"></i>
                        Save Connection
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal modal-blur fade" id="modal-delete" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-sm modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-body">
                <div class="modal-title">Really delete?</div>
                <div>Do you really want to delete connection <strong id="delete-endpoint-name"></strong>?</div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="confirm-delete-btn">Yes, Delete</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}{% endblock %}
